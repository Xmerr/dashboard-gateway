services:
  dashboard-gateway:
    image: ${DOCKERHUB_USERNAME:-xmer}/dashboard-gateway:latest
    container_name: dashboard-gateway
    restart: unless-stopped
    environment:
      - PORT=${PORT:-4000}
      - SUBGRAPHS=[{"name":"docker-health-monitor","url":"http://docker-health-monitor:4002/graphql","wsUrl":"ws://docker-health-monitor:4003/graphql"},{"name":"fitgirl","url":"http://fitgirl-subgraph:4004/graphql","wsUrl":"ws://fitgirl-subgraph:4005/graphql"}]
      - RABBITMQ_URL=${RABBITMQ_URL}
      - LOKI_HOST=${LOKI_HOST:-}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    ports:
      - "${PORT:-4000}:4000"
      - "${WS_PORT:-4001}:4001"
    depends_on:
      - docker-health-monitor
      - fitgirl-subgraph
    networks:
      - network

  docker-health-monitor:
    image: ${DOCKERHUB_USERNAME:-xmer}/docker-health-monitor:latest
    container_name: docker-health-monitor
    restart: unless-stopped
    environment:
      - RABBITMQ_URL=${RABBITMQ_URL}
      - GRAPHQL_PORT=4002
      - GRAPHQL_WS_PORT=4003
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - network

  fitgirl-subgraph:
    image: ${DOCKERHUB_USERNAME:-xmer}/fitgirl-subgraph:latest
    container_name: fitgirl-subgraph
    restart: unless-stopped
    environment:
      - DATABASE_PATH=/app/data/fitgirl.db
      - RABBITMQ_URL=${RABBITMQ_URL}
      - GRAPHQL_PORT=4004
      - GRAPHQL_WS_PORT=4005
      - LOKI_HOST=${LOKI_HOST:-}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    volumes:
      - fitgirl-data:/app/data
    networks:
      - network

volumes:
  fitgirl-data:
    external: true

networks:
  network:
    external: true
